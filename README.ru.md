# redmine_chat_telegram

Плагин разработан в компании [Centos-admin.ru](https://centos-admin.ru)

Плагин для Redmine для создания групповых чатов в Telegram.

Плагин `redmine_chat_telegram` используется для создания группового чата, связанного с тикетом, и записи его логов в архиве Redmine. Связанные групповые чаты могут легко быть созданы с помощью ссылки "Создать чат Telegram", которая появится на странице тикета. Вы сможете скопировать ссылку и передать её любому, кого Вы захотите подключить к этому чату.

## Установка

### Требования

* [Telegram CLI](https://github.com/vysheng/tg) должен быть установлен
* У Вас должен быть аккаунт пользователя Telegram
* У Вас должен быть аккаунт для создания ботов в Telegram
* Установите [Telegrammer gem](https://github.com/mayoral/telegrammer) и поместите его в `Gemfile.local`
* Плагин [redmine_sidekiq](https://github.com/ogom/redmine_sidekiq) должен быть установлен

### Конфигурация в Telegram CLI

Используйте файл `config/telegram.yml.example` в качестве шаблона.
Скопируйте его в папку `config/` и переименуйте в `telegram.yml`.
Установите корректные значения для переменных `telegram_cli_path` и `telegram_cli_public_key_path`.

### Первый запуск

Запустите `telegram-cli` на Вашем сервере Redmine и залогиньтесь через него в Telegram. После этого Вы сможете создавать групповые чаты.

### Создание бота в Telegram

Необходимо создать нового бота и получить его токен. Для этого в Telegram используется [@BotFather]. Наберите `start` для получения полного списка предоставляемых им команд.

Наберите `/newbot` для регистрации нового бота`. @BotFather спросит у Вас имя нового бота. Имя бота должно оканчиваться на "bot".

При успешной регистрации @BotFather даст вам токен Вашего нового бота, а также ссылку для того, чтобы Вы могли быстро добавить его в Ваш список контактов. Вам придётся придумать новое имя если регистрация не удастся.

Установите Privacy mode в disabled с помощью команды `/setprivacy`. Это позволит боту слушать групповой чат и добавлять его логи в архив чатов Redmine.

Введите токен бота на странице Plugin Settings для того чтобы добавить бота в ваш чат.

### Добавление бота в список контактов

Наберите `/start` для вашего бота под своим аккаунтом.
Это позволит пользователю добавить бота в групповой чат.

### Запуск бота

Для запуска бота выполните следующее rake задание:

```shell
bundle exec rake chat_telegram:bot PID_DIR='/pid/dir'
```
### Использование

Откройте тикет. Справа на странице Вы увидите ссылку `создать чат Telegram`. Щёлкните по ней и Вы создадите групповой чат в Telegram, который будет связан с этим тикетом. Ссылка изменится на `Войти в чат Telegram`. Щёлкните на ней чтобы присоединиться к чату, открыв его в своём клиенте Telegram. Вы сможете скопировать и передать ссылку любому кому захотите для того, чтобы он смог присоединиться к этому групповому чату.
