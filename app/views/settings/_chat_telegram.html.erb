<% unless Redmine::Plugin.installed?('redmine_telegram_common') %>
  <h1 style="text-align: center">
    !!! <a href="https://github.com/centosadmin/redmine_telegram_common" target="_blank">redmine_telegram_common</a>
    <%= t('redmine_chat_telegram.settings.required') %> !!!
  </h1>
<% end %>

<% unless Redmine::Plugin.installed?('redmine_sidekiq') %>
  <h1 style="text-align: center">
    !!! <a href="https://github.com/ogom/redmine_sidekiq" target="_blank">redmine_sidekiq</a>
    <%= t('redmine_chat_telegram.settings.required') %> !!!
  </h1>
<% end %>

<p>
  <label for="settings_telegram_bot_token">Bot Token</label>
  <%= text_field_tag 'settings[bot_token]', @settings['bot_token'], size: 50 %>
</p>
<p>
  <label>
    <%= t 'redmine_chat_telegram.settings.daily_report' %>
  </label>
  <%= check_box_tag 'settings[daily_report]', '1', @settings['daily_report'] %>
</p>
<p>
  <label>
    <%= t 'redmine_chat_telegram.settings.close_issue_statuses' %>
  </label>
  <%= select_tag 'settings[close_issue_statuses]',
  options_for_select(IssueStatus.sorted.map { |s| [s.name, s.id] }, @settings['close_issue_statuses']), multiple: true %>
<em class="info"><%= t 'redmine_chat_telegram.settings.close_issue_statuses_hint' %></em>
</p>

<hr>

<div style="display: flex; align-items: center;">
  <div style="flex: 1; padding: 0.5em;">
    <h3>WebHooks</h3>

    <%= link_to chat_telegram_api_bot_init_path, method: 'post' do %><button type="button"><%= t 'redmine_chat_telegram.settings.bot_init' %></button><% end %>

    <%= link_to chat_telegram_api_bot_deinit_path, method: 'delete' do %><button type="button"><%= t 'redmine_chat_telegram.settings.bot_deinit' %></button><% end %>
  </div>

  <div style="flex: 1; padding: 0.5em;">
    <h3>getUpdates</h3>

    <pre><%= t 'redmine_chat_telegram.settings.get_updates_hint' %></pre>
  </div>
</div>

<%= hidden_field_tag 'settings[bot_name]', @settings['bot_name'] %>
<%= hidden_field_tag 'settings[bot_id]',   @settings['bot_id']   %>
<%= hidden_field_tag 'settings[robot_id]', @settings['robot_id'] %>
